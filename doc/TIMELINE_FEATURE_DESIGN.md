# 时间轴功能设计文档（1.0版本）

## 1. 功能概述

时间轴功能旨在通过线性展示相关事件集合，帮助用户理解事件发展脉络和历史背景。该功能允许用户创建、编辑、查看和管理时间轴，将多个相关事件组织成一个连贯的故事线。

## 2. 页面结构设计

### 2.1 时间轴列表页
- **路径**: `/timelines`
- **功能**: 展示所有用户可访问的时间轴列表
- **UI表现**: 
  - 时间轴卡片网格布局
  - 每个卡片显示时间轴标题、创建者、包含事件数量和创建日期
  - 提供"创建新时间轴"按钮
  - 支持按标题搜索和按创建日期排序

### 2.2 时间轴创建/编辑页
- **路径**: `/timelines/create` 和 `/timelines/[id]/edit`
- **功能**: 创建新时间轴或编辑现有时间轴的基本信息
- **UI表现**: 
  - 表单界面，包含标题、描述等字段
  - 提供添加/移除事件的界面
  - 保存和取消按钮

### 2.3 时间轴详情页
- **路径**: `/timelines/[id]`
- **功能**: 展示特定时间轴的详细内容和事件序列
- **UI表现**: 
  - 顶部显示时间轴标题和描述
  - 主体为线性时间轴视图，按时间顺序展示相关事件
  - 每个事件显示事件标题、日期、简要描述和缩略图
  - 支持横向或纵向滚动浏览
  - 提供编辑和分享时间轴的操作按钮

### 2.4 事件详情页集成
- **路径**: `/event/[id]` 页面中添加时间轴相关信息
- **功能**: 显示当前事件所属的时间轴信息
- **UI表现**: 
  - 在事件详情下方展示"该事件所属时间轴"区域
  - 点击可跳转到对应时间轴详情页

## 3. 组件设计

### 3.1 TimelineList 组件
- **作用**: 展示时间轴列表
- **主要功能**: 
  - 从API获取时间轴列表数据
  - 渲染时间轴卡片网格
  - 处理列表过滤和排序

### 3.2 TimelineViewer 组件
- **作用**: 展示单个时间轴的详细内容
- **主要功能**: 
  - 接收时间轴ID，从API获取数据
  - 渲染线性时间轴布局
  - 处理时间轴滚动和事件点击
  - 响应式设计，适配不同屏幕尺寸

### 3.3 TimelineForm 组件
- **作用**: 创建和编辑时间轴表单
- **主要功能**: 
  - 表单字段验证
  - 时间轴基本信息管理
  - 事件添加/移除功能
  - 表单数据提交处理

### 3.4 TimelineEventCard 组件
- **作用**: 在时间轴中显示单个事件
- **主要功能**: 
  - 展示事件基本信息
  - 提供到事件详情页的链接
  - 视觉上连接相邻事件，形成时间线

## 4. 数据模型扩展

基于现有系统的Event表，需要添加以下新表来支持时间轴功能：

### 4.1 Timeline 表
- **字段**: 
  - `id` (主键)
  - `title` (时间轴标题)
  - `description` (时间轴描述)
  - `creatorId` (创建者用户ID，外键关联User表)
  - `createdAt` (创建时间)
  - `updatedAt` (更新时间)

### 4.2 TimelineEvent 表 (关联表)
- **字段**: 
  - `id` (主键)
  - `timelineId` (时间轴ID，外键关联Timeline表)
  - `eventId` (事件ID，外键关联Event表)
  - `order` (在时间轴中的排序位置)
  - `createdAt` (创建时间)

## 5. API路由设计

### 5.1 GET /api/timelines
- **功能**: 获取时间轴列表
- **参数**: 可选的搜索关键词和排序方式
- **返回**: 时间轴列表数据

### 5.2 GET /api/timelines/[id]
- **功能**: 获取特定时间轴的详细信息
- **返回**: 包含事件列表的时间轴数据

### 5.3 POST /api/timelines
- **功能**: 创建新时间轴
- **参数**: 时间轴标题、描述等信息
- **返回**: 创建成功的时间轴数据

### 5.4 PUT /api/timelines/[id]
- **功能**: 更新现有时间轴
- **参数**: 要更新的时间轴信息
- **返回**: 更新后的时间轴数据

### 5.5 DELETE /api/timelines/[id]
- **功能**: 删除时间轴
- **返回**: 成功删除的确认信息

### 5.6 POST /api/timelines/[id]/events
- **功能**: 向时间轴添加事件
- **参数**: 事件ID和排序位置
- **返回**: 更新后的时间轴事件列表

### 5.7 DELETE /api/timelines/[id]/events/[eventId]
- **功能**: 从时间轴移除事件
- **返回**: 更新后的时间轴事件列表

## 6. 与现有系统集成

### 6.1 事件管理集成
- 在事件详情页中显示该事件所属的时间轴
- 在事件创建和编辑界面添加选项，允许用户选择将事件添加到现有时间轴

### 6.2 用户权限集成
- 继承现有用户权限系统，时间轴创建者拥有完整管理权限
- 支持设置时间轴的可见性（公开/私有）

### 6.3 国际化支持
- 为时间轴相关UI元素添加国际化翻译
- 遵循现有i18n框架实现多语言支持

## 7. 交互设计

### 7.1 时间轴创建流程
1. 用户点击"创建新时间轴"按钮
2. 填写时间轴基本信息表单
3. 搜索并添加相关事件到时间轴
4. 调整事件顺序
5. 保存时间轴

### 7.2 时间轴浏览体验
- 时间轴采用可滚动的线性布局
- 事件节点悬停时显示简要信息
- 点击事件节点跳转到事件详情页
- 支持拖拽调整事件顺序（后续版本）

### 7.3 响应式适配
- 桌面端：水平时间轴布局，支持横向滚动
- 移动端：垂直时间轴布局，支持纵向滚动
- 平板设备：根据屏幕方向自动切换布局

## 8. 后续优化方向

### 8.1 高级功能规划
- 协作编辑：允许多个用户共同编辑同一个时间轴
- 时间轴模板：提供预设的时间轴模板供用户快速创建
- 时间轴导出：支持将时间轴导出为PDF或图片格式
- 高级排序：支持按多种条件对时间轴事件进行排序
- 时间轴可视化：添加时间范围选择器和缩放功能

### 8.2 性能优化
- 时间轴数据懒加载
- 事件卡片虚拟化渲染
- 图片资源优化
- API响应缓存

---

## 版本说明

**时间轴功能 1.0版本**：专注于核心功能实现，包括时间轴的创建、查看、编辑和基本事件组织，提供良好的用户体验和响应式设计。后续版本将基于用户反馈和使用数据进行迭代优化，逐步添加更多高级功能。